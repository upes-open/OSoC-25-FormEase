<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Toolbox</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="formease-toolbox">
      <h4>FormEase Toolbox</h4>

      <!-- Dropdown -->
      <div id="dropdown">
        <label for="task">Choose what you want to do : </label>
        <select id="task" name="task">
          <option value="nill">Select</option>
          <option value="resize">Resize</option>
          <option value="compress">Compress</option>
          <option value="convert">Convert</option>
        </select>
      </div>

      <!-- Basic Range Control -->
      <div id="resize" class="hidden">
        <div id="resize-inner">
          <label for="resize">Resize :</label>
          <input type="range" id="resize-range" min="10" max="100" value="100" class="ms-4" />
          <br /><br />
          <label for="resize-file-input">Upload File:</label>
          <input type="file" id="resize-file-input" />
          <div id="file-info" style="font-size: 12px; color: #333; margin-top: 8px;"></div>
        </div>
      </div>

      <div id="resize-scale"></div>

      <!-- Compress Input -->
      <div id="compress" class="hidden">
        <div id="compress-inner">
          <label for="compress-input">Compress to : </label>
          <input type="number" id="compress-input" name="compress" min="1" max="100" />
          <span>%</span>
        </div>
      </div>

      <!-- Convert Dropdown -->
      <div id="convert" class="hidden">
        <div id="convert-inner">
          <label for="convert-dropdown">Convert to : </label>
          <select id="convert-dropdown" name="convert">
            <option value="PNG" selected>PNG</option>
            <option value="JPG">JPG</option>
            <option value="JPEG">JPEG</option>
          </select>
        </div>
      </div>

      <button id="apply" class="hidden" style="margin-right: 10px">Apply</button>

      <div class="reset-section">
        <button id="resetButton">Reset</button>
      </div>

      <div class="formease-feedback" style="display: none; margin-top: 10px; padding: 8px; border-radius: 4px;"></div>

      <div id="image-preview-area" style="margin-top: 15px; text-align: center; display: none">
        <img id="image-preview" src="#" alt="Image Preview" style="max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #ddd;" />
      </div>
    </div>

    <script>
      // Selecting Buttons
      const resetButton = document.querySelector("#resetButton");
      const feedbackArea = document.querySelector(".formease-feedback");

      resetButton.addEventListener("click", () => {
        const toolbox = document.querySelector(".formease-toolbox");
        const inputId = toolbox.dataset.inputId;
        const input = document.querySelector(`input[data-form-ease-id="${inputId}"]`);
        if (input) {
          input.value = null;
          document.querySelector("#file-info").innerText = "";
          document.querySelector("#image-preview-area").style.display = "none";
        }
      });

      document.getElementById("resize-file-input").addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const originalSizeKB = file.size / 1024;
        let originalText = originalSizeKB > 1024 ? `Original: ${(originalSizeKB / 1024).toFixed(2)} MB` : `Original: ${originalSizeKB.toFixed(2)} KB`;

        const reader = new FileReader();
        reader.onloadend = () => {
          const arrayBuffer = reader.result;
          const blob = new Blob([arrayBuffer]);

          const finalSizeKB = blob.size / 1024;
          let finalText = finalSizeKB > 1024 ? `Final: ${(finalSizeKB / 1024).toFixed(2)} MB` : `Final: ${finalSizeKB.toFixed(2)} KB`;
          const savedPercent = 100 - (finalSizeKB / originalSizeKB) * 100;
          const savedText = `Saved: ${savedPercent.toFixed(1)}%`;

          const fileInfo = document.getElementById("file-info");
          fileInfo.innerHTML = `${originalText} â†’ <span class="badge">${finalText}</span> <span class="badge">${savedText}</span>`;
        };
        reader.readAsArrayBuffer(file);
      });

      window.addEventListener("beforeunload", () => {
        document.querySelectorAll(".formease-toolbox").forEach(t => t.remove());
        console.log("[FormEase] Cleanup completed");
      });

      console.log("[FormEase] Content script loaded and initialized");
    </script>
  </body>
</html>
