<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Toolbox</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div
    class="formease-toolbox h-auto w-auto flex flex-col items-center justify-center float-right mx-10 my-6 px-12 py-8 text-white gap-4">
    <!---Basic Template-->
    <h4 class="text-2xl font-black">FormEase Toolbox</h4>

    <!-- Dropdown -->
    <div id="dropdown" class="flex">
      <label for="task">Choose what you want to do : </label>
      <select id="task" name="task" class="text-black ms-4 p-2">
        <option value="nill">Select</option>
        <option value="resize">Resize</option>
        <option value="compress">Compress</option>
        <option value="convert">Convert</option>
      </select>
    </div>

    <!-- Basic Range Control -->
    <div id="resize" class="hidden flex flex-col gap-4">
      <div id="resizeRange" class="flex items-center">
        <label for="resize">Resize :</label>
        <input type="range" id="resize" min="10" max="100" value="100" class="ms-4" />
      </div>
      <div class="resizeTaskBtns flex gap-4">
        <button id="resizeBtn" class="taskBtn">Resize</button>
        <button id="previewBtn" class="taskBtn">Preview</button>
      </div>
    </div>

    <!-- Compress Button -->
    <div id="compress" class="hidden flex gap-4">
      <button id="compressBtn" class="taskBtn">Compress</button>
      <button id="previewBtn" class="taskBtn">Preview</button>
    </div>

    <!-- Convert Button -->
    <div id="convert" class="hidden flex gap-4">
      <button id="convertBtn" class="taskBtn">Convert</button>
      <button id="previewBtn" class="taskBtn">Preview</button>
    </div>

    <!-- Reset Button -->
    <div class="Goofy ahh ->  reset-section flex gap-4">
      <button id="resetButton" class="taskBtn bg-red-500 hover:bg-red-600">Reset</button>
    </div>

    <!-- Feedback Area -->
    <div id="feedbackArea" class="feedback text-sm text-gray-300"></div>
  </div>

  <script>
    // Assuming originalFiles is a Map defined elsewhere (e.g., in content.js or a shared module)
    // const originalFiles = new Map(); // Define this globally if not already present

    // Selecting Dropdown & Buttons
    let dropdown = document.querySelector("#task");
    let resize = document.querySelector("#resize");
    let compress = document.querySelector("#compress");
    let convert = document.querySelector("#convert");
    let resetButton = document.querySelector("#resetButton");
    let feedbackArea = document.querySelector("#feedbackArea");

    // Making the Dropdown Dynamic
    dropdown.addEventListener("change", (e) => {
      dropdown.value = e.target.value;

      // Logic for Visibility of Buttons
      if (dropdown.value == "resize") {
        resize.classList.remove("hidden");
        compress.classList.add("hidden");
        convert.classList.add("hidden");
      } else if (dropdown.value == "compress") {
        compress.classList.remove("hidden");
        resize.classList.add("hidden");
        convert.classList.add("hidden");
      } else if (dropdown.value == "convert") {
        convert.classList.remove("hidden");
        compress.classList.add("hidden");
        resize.classList.add("hidden");
      } else {
        resize.classList.add("hidden");
        compress.classList.add("hidden");
        convert.classList.add("hidden");
      }
    });

    // Reset Button Functionality
    resetButton.addEventListener("click", () => {
      // Query all file inputs with data-form-ease-id on the page
      const fileInputs = document.querySelectorAll("input[type='file'][data-form-ease-id]");
      fileInputs.forEach((input) => {
        const easeId = input.getAttribute("data-form-ease-id");
        if (originalFiles && originalFiles.has(easeId)) {
          const originalFile = originalFiles.get(easeId);

          // Use DataTransfer to restore the original file
          const dataTransfer = new DataTransfer();
          dataTransfer.items.add(originalFile);

          // Workaround for read-only input.files
          const hiddenInput = document.createElement("input");
          hiddenInput.type = "file";
          hiddenInput.style.display = "none";
          hiddenInput.files = dataTransfer.files;
          input.parentNode.insertBefore(hiddenInput, input);
          input.parentNode.removeChild(input);
          input.parentNode.appendChild(input); // Reinsert to reset

          // Dispatch change event
          hiddenInput.dispatchEvent(new Event("change", { bubbles: true }));
          input.dispatchEvent(new Event("change", { bubbles: true }));

          // Clear UI feedback
          feedbackArea.innerHTML = "";
          // Clear previews or processed outputs (adjust selectors as needed)
          document.querySelectorAll(".preview, .processed-output").forEach((el) => el.remove());
        } else {
          feedbackArea.innerHTML = "No original file found to reset.";
          setTimeout(() => (feedbackArea.innerHTML = ""), 3000); // Clear after 3s
        }
      });
    });
  </script>
</body>

</html>